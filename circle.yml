---
# CircleCI configuration file (circle.yml).

machine:
  - |
    if [ "$CIRCLE_NODE_INDEX" == 0 ]; then
      ruby:
        version: 1.9.3
      environment:
        PUPPET_GEM_VERSION: '~> 3.0'
    elif [ "$CIRCLE_NODE_INDEX" == 1 ]; then
      ruby:
        version: 2.1.5
      environment:
        PUPPET_GEM_VERSION: '~> 3.0'
    elif [ "$CIRCLE_NODE_INDEX" == 2 ]; then
      ruby:
        version: 2.1.6
      environment:
        PUPPET_GEM_VERSION: '~> 4.0'
        STRICT_VARIABLES: yes
    fi

test:
  override:
    - ./scripts/circle.bash unit_tests:
        parallel: true
    - ./scripts/circle.bash acceptance_tests:
        parallel: true

notify:
  webhooks:
    # A list of hook hashes, containing the url field
    # gitter hook
    - url: https://webhooks.gitter.im/e/da8c065419a91983f0cf

deployment:
  bugfix:
    branch: /^bugfix.*/
    commands:
      - ./scripts/circle.bash merge release/patch
      - ./scripts/circle.bash merge release/minor
  improvement:
    branch: /^improvement.*/
    commands:
      - ./scripts/circle.bash merge release/patch
      - ./scripts/circle.bash merge release/minor
  master:
    branch: master
    commands:
      - ./scripts/circle.bash merge release/last
      - ./scripts/circle.bash deploy
