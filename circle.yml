--- 
dependencies: 
  cache_directories: 
    - ../.rvm/rubies
  override: 
    - |
        case $CIRCLE_NODE_INDEX in
         0) export RVM=1.9.3-p448
           rvm use ruby-${RVM}
           PUPPET_GEM_VERSION="~> 3.0" rvm-exec $RVM bash -c "bundle check --path=vendor/bundle || bundle install --path=vendor/bundle"
           ;;
         1) export RVM=2.1.5
           rvm use ruby-${RVM}
           PUPPET_GEM_VERSION="~> 3.0" rvm-exec $RVM bash -c "bundle check --path=vendor/bundle || bundle install --path=vendor/bundle"
           ;;
         2) export RVM=2.1.6
           rvm use ruby-${RVM}
           PUPPET_GEM_VERSION="~> 4.0" rvm-exec $RVM bash -c "bundle check --path=vendor/bundle || bundle install --path=vendor/bundle"
           ;;
         3) bundle install --without development
           ;;
        esac
deployment: 
  bugfix: 
    branch: /^bugfix.*/
    commands: 
      - "./scripts/circle.bash merge release/patch"
      - "./scripts/circle.bash merge release/minor"
  improvement: 
    branch: /^improvement.*/
    commands: 
      - "./scripts/circle.bash merge release/patch"
      - "./scripts/circle.bash merge release/minor"
  master: 
    branch: master
    commands: 
      - "./scripts/circle.bash merge release/last"
      - "./scripts/circle.bash deploy"
notify: 
  webhooks: 
    - 
      url: "https://webhooks.gitter.im/e/da8c065419a91983f0cf"
test: 
  override: 
    - 
      ? "case $CIRCLE_NODE_INDEX in 0) RVM=1.9.3-p551 rvm-exec 1.9.3-p551 ./scripts/circle.bash unit_tests ;; 1) RVM=2.1.5 rvm-exec 2.1.5 ./scripts/circle.bash unit_tests ;; 2) RVM=2.1.6 rvm-exec 2.1.6 ./scripts/circle.bash unit_tests ;; 3) bundle exec rake rubocop ;; esac"
      : 
        parallel: true
    - ./scripts/circle.bash acceptance_tests circle_centos6:
        parallel: true
    - ./scripts/circle.bash acceptance_tests circle_centos7:
        parallel: true
    - ./scripts/circle.bash acceptance_tests circle_debian7:
        parallel: true
    - ./scripts/circle.bash acceptance_tests circle_ubuntu12:
        parallel: true
    - ./scripts/circle.bash acceptance_tests circle_ubuntu14:
        parallel: true
